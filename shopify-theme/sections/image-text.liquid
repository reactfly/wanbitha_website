<section class="image-text">
  <div class="container">
    <div class="image-text__grid{% if section.settings.reverse_layout %} is-reversed{% endif %}">
      {%- comment -%} Image Side {%- endcomment -%}
      <div
        class="image-text__media reveal-{% if section.settings.reverse_layout %}right{% else %}left{% endif %} shimmer"
        data-reveal-image
        data-parallax="0.1"
      >
        {%- if section.settings.image != blank -%}
          <img
            src="{{ section.settings.image | image_url: width: 800 }}"
            alt="{{ section.settings.image.alt | default: section.settings.heading }}"
            loading="lazy"
            width="400"
            height="500"
            onload="this.parentElement.classList.remove('shimmer')"
            style="will-change: transform;"
          >
        {%- else -%}
          {{ 'image' | placeholder_svg_tag: 'placeholder-svg' }}
        {%- endif -%}
      </div>

      {%- comment -%} Text Side {%- endcomment -%}
      <div class="image-text__content">
        {%- if section.settings.label != blank -%}
          <span class="label-tag reveal stagger-1">{{ section.settings.label }}</span>
        {%- endif -%}

        <h2
          class="heading-display heading-display--lg {% if section.settings.gradient_title %}text-gradient{% endif %} reveal stagger-2"
          data-split-text
        >
          {{ section.settings.heading }}
        </h2>

        {%- if section.settings.body != blank -%}
          <div class="text-editorial reveal stagger-3" style="font-size:1.05rem;line-height:1.8;">
            {{ section.settings.body }}
          </div>
        {%- endif -%}

        {%- if section.settings.show_stats -%}
          <div class="image-text__stats reveal stagger-4">
            {%- for block in section.blocks -%}
              <div {{ block.shopify_attributes }}>
                <div
                  class="image-text__stat-number"
                  data-count-up="{{ block.settings.number }}"
                  data-suffix="{{ block.settings.suffix }}"
                >
                  0
                </div>
                <div class="image-text__stat-label">{{ block.settings.label }}</div>
              </div>
            {%- endfor -%}
          </div>
        {%- endif -%}

        {%- if section.settings.button_text != blank -%}
          <div class="reveal stagger-5" style="margin-top:12px;">
            <a
              href="{{ section.settings.button_url }}"
              class="btn btn--{{ section.settings.button_style }} btn--magnetic"
            >
              {{ section.settings.button_text }}
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M5 12h14M12 5l7 7-7 7"/>
              </svg>
            </a>
          </div>
        {%- endif -%}
      </div>
    </div>
  </div>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      // Parallax for image
      document.querySelectorAll('.image-text__media[data-parallax]').forEach((media) => {
        window.addEventListener(
          'scroll',
          () => {
            const scrolled = window.scrollY;
            const rect = media.getBoundingClientRect();
            if (rect.top < window.innerHeight && rect.bottom > 0) {
              const speed = 0.05;
              const yPos = (scrolled - rect.top) * speed;
              const img = media.querySelector('img');
              if (img) img.style.transform = `scale(1.1) translateY(${yPos}px)`;
            }
          },
          { passive: true }
        );
      });

      const observer = new IntersectionObserver(
        (entries) => {
          entries.forEach((entry) => {
            if (entry.isIntersecting) {
              entry.target.classList.add('is-visible');
              if (entry.target.hasAttribute('data-reveal-image')) {
                entry.target.classList.add('image-revealed');
              }
              observer.unobserve(entry.target);
            }
          });
        },
        { rootMargin: '0px 0px -50px 0px', threshold: 0.1 }
      );
      document
        .querySelectorAll('.image-text .reveal, .image-text .reveal-left, .image-text .reveal-right')
        .forEach((el) => observer.observe(el));
    });
  </script>
</section>

{% schema %}
{
  "name": "Imagem + Texto",
  "tag": "section",
  "class": "section-image-text",
  "settings": [
    { "type": "image_picker", "id": "image", "label": "Imagem" },
    { "type": "checkbox", "id": "reverse_layout", "label": "Inverter layout (texto à esquerda)", "default": false },
    { "type": "text", "id": "label", "label": "Etiqueta", "default": "Nossa História" },
    { "type": "text", "id": "heading", "label": "Título", "default": "Arte que Transcende o Tempo" },
    { "type": "checkbox", "id": "gradient_title", "label": "Título com gradiente", "default": true },
    {
      "type": "richtext",
      "id": "body",
      "label": "Texto",
      "default": "<p>Desde 2018, nossas obras têm atravessado fronteiras — conectando colecionadores ao que existe de mais autêntico na arte contemporânea brasileira.</p>"
    },
    { "type": "checkbox", "id": "show_stats", "label": "Exibir estatísticas", "default": true },
    { "type": "text", "id": "button_text", "label": "Texto do botão", "default": "Conhecer a Artista" },
    { "type": "url", "id": "button_url", "label": "Link do botão" },
    {
      "type": "select",
      "id": "button_style",
      "label": "Estilo",
      "options": [
        { "value": "primary", "label": "Primário" },
        { "value": "glass", "label": "Glass" }
      ],
      "default": "primary"
    }
  ],
  "blocks": [
    {
      "type": "stat",
      "name": "Estatística",
      "settings": [
        { "type": "number", "id": "number", "label": "Número", "default": 150 },
        { "type": "text", "id": "suffix", "label": "Sufixo", "default": "+" },
        { "type": "text", "id": "label", "label": "Rótulo", "default": "Obras Criadas" }
      ]
    }
  ],
  "presets": [
    {
      "name": "Imagem + Texto",
      "blocks": [
        { "type": "stat", "settings": { "number": 150, "suffix": "+", "label": "Obras Criadas" } },
        { "type": "stat", "settings": { "number": 40, "suffix": "+", "label": "Exposições" } },
        { "type": "stat", "settings": { "number": 12, "suffix": "", "label": "Países" } }
      ]
    }
  ]
}
{% endschema %}
