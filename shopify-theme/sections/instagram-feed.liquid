<section class="instagram-feed section-spacing">
  <div class="container is-fluid">
    <div class="instagram-feed__header reveal">
      <span class="label-tag">Social</span>
      <h2 class="heading-display text-gradient">@{{ section.settings.username }}</h2>
      <p class="body-text">{{ section.settings.description }}</p>
    </div>

    <div class="instagram-grid">
      {%- for block in section.blocks -%}
        <a
          href="{{ block.settings.link }}"
          target="_blank"
          class="instagram-item reveal stagger-{{ forloop.index }}"
          {{ block.shopify_attributes }}
        >
          <div class="instagram-item__media shimmer">
            {%- if block.settings.image != blank -%}
              <img
                src="{{ block.settings.image | image_url: width: 400, height: 400, crop: 'center' }}"
                alt="Instagram @{{ section.settings.username }}"
                loading="lazy"
                width="400"
                height="400"
                onload="this.parentElement.classList.remove('shimmer')"
              >
            {%- else -%}
              {{ 'image' | placeholder_svg_tag: 'placeholder-svg' }}
            {%- endif -%}

            <div class="instagram-item__overlay">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="32"
                height="32"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path><line x1="17.5" y1="6.5" x2="17.51" y2="6.5"></line>
              </svg>
              <div class="instagram-item__meta">
                <span>‚ù§Ô∏è {{ block.settings.likes }}</span>
                <span>üí¨ {{ block.settings.comments }}</span>
              </div>
            </div>
          </div>
        </a>
      {%- endfor -%}
    </div>

    <div class="instagram-feed__cta reveal" style="margin-top: 32px;">
      <a
        href="https://instagram.com/{{ section.settings.username }}"
        target="_blank"
        class="btn btn--primary btn--magnetic"
      >
        Seguir no Instagram
      </a>
    </div>
  </div>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const observer = new IntersectionObserver(
        (entries) => {
          entries.forEach((entry) => {
            if (entry.isIntersecting) {
              entry.target.classList.add('is-visible');
              observer.unobserve(entry.target);
            }
          });
        },
        { rootMargin: '0px 0px -50px 0px', threshold: 0.1 }
      );
      document.querySelectorAll('.instagram-feed .reveal').forEach((el) => observer.observe(el));
    });
  </script>
</section>

{% schema %}
{
  "name": "Feed Instagram (Curated)",
  "tag": "section",
  "class": "section-instagram",
  "settings": [
    { "type": "text", "id": "username", "label": "Username (sem @)", "default": "wanbitha.art" },
    {
      "type": "text",
      "id": "description",
      "label": "Descri√ß√£o",
      "default": "Bastidores, inspira√ß√µes e obras em progresso."
    }
  ],
  "blocks": [
    {
      "type": "post",
      "name": "Post",
      "settings": [
        { "type": "image_picker", "id": "image", "label": "Imagem do Post" },
        { "type": "url", "id": "link", "label": "Link do Post" },
        { "type": "text", "id": "likes", "label": "Likes (Fake Count)", "default": "1.2k" },
        { "type": "text", "id": "comments", "label": "Comments", "default": "45" }
      ]
    }
  ],
  "presets": [
    {
      "name": "Feed Instagram",
      "blocks": [
        { "type": "post" },
        { "type": "post" },
        { "type": "post" },
        { "type": "post" },
        { "type": "post" },
        { "type": "post" }
      ]
    }
  ]
}
{% endschema %}
