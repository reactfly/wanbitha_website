version: 1
frontend:
  phases:
    preBuild:
      commands:
        # ═══ Force Node.js 20 (CRITICAL for Vite 7 + npm lockfile v3) ═══
        - nvm install 20
        - nvm use 20
        - node --version
        - npm --version
        # ═══ Install Dependencies ═══
        - npm ci --prefer-offline --no-audit --no-fund
    build:
      commands:
        # ═══ Production Build ═══
        - npm run build
        # ═══ Post-Build Validation ═══
        - test -f dist/index.html && echo "✓ Build OK" || (echo "✗ FAIL: index.html missing!" && exit 1)
  artifacts:
    baseDirectory: dist
    files:
      - "**/*"
  cache:
    paths:
      - "node_modules/**/*"
